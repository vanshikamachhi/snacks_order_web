<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dhriya Nasta House ‚Äî Booking System</title>
<style>
  body { font-family: "Poppins", sans-serif; background-color: #fafafa; margin: 0; padding: 20px; }
  .container { max-width: 420px; margin: auto; background: white; padding: 20px 25px; border-radius: 15px; box-shadow: 0 0 10px #ccc; }
  h2 { text-align: center; color: #b30000; font-weight: 700; margin-bottom: 25px; font-size: 1.6em; }
  label { display: block; font-weight: 600; margin-bottom: 6px; color: #333; }
  input[type="text"], input[type="tel"], input[type="number"] { width: 100%; padding: 10px; border-radius: 8px; border: 1px solid #ccc; margin-bottom: 18px; font-size: 15px; }
  .item { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; padding: 8px 10px; background: #fff5f5; border-radius: 10px; }
  .item-title { font-weight: 600; color: #222; }
  .btn { width: 100%; padding: 10px; border: none; background-color: #b30000; color: white; font-weight: 600; font-size: 15px; border-radius: 8px; margin-top: 10px; cursor: pointer; }
  .btn:disabled { background-color: #aaa; cursor: not-allowed; }
  .popup { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.6); justify-content: center; align-items: center; }
  .popup-content { background: white; border-radius: 12px; padding: 25px; width: 90%; max-width: 380px; }
  .popup-content h3 { text-align: center; color: #b30000; margin-bottom: 15px; }
  .bill-item { display: flex; justify-content: space-between; margin: 6px 0; }
  .close-btn { margin-top: 15px; background: #333; }
  .total { text-align: right; font-weight: bold; color: #b30000; margin-top: 8px; }
  .bookings { margin-top: 25px; background: #fff8f0; padding: 10px; border-radius: 10px; }
  .booking-entry { border-bottom: 1px solid #ddd; padding: 6px 0; }
  .booking-entry:hover { background: #ffe6e6; border-radius: 6px; }
</style>
</head>
<body>
  <div class="container">
    <h2>Dhriya Nasta House</h2>

    <label>Customer Name</label>
    <input id="custName" type="text" placeholder="Enter name" />

    <label>WhatsApp Number</label>
    <input id="custPhone" type="tel" value="+91 " />

    <h3 style="color:#b30000;margin-top:25px;">Select Items</h3>

    <div id="items">
      <div class="item">
        <span class="item-title">Premium Kesar Katri ‚Äî 250g ‚Äî ‚Çπ480</span>
        <input type="number" min="0" value="0" data-name="Premium Kesar Katri" data-weight="250g" data-price="480" />
      </div>
      <div class="item">
        <span class="item-title">Royal Dryfruit Khajurpak ‚Äî 250g ‚Äî ‚Çπ550</span>
        <input type="number" min="0" value="0" data-name="Royal Dryfruit Khajurpak" data-weight="250g" data-price="550" />
      </div>
      <div class="item">
        <span class="item-title">Special Anjeer Roll ‚Äî 250g ‚Äî ‚Çπ420</span>
        <input type="number" min="0" value="0" data-name="Special Anjeer Roll" data-weight="250g" data-price="420" />
      </div>
    </div>

    <div id="totalDisplay" class="total">Total: ‚Çπ0</div>

    <button id="confirmPay" class="btn">üí∞ Confirm Payment</button>
    <button id="generateToken" class="btn" disabled>üé´ Generate Token</button>
    <button id="waSend" class="btn" disabled>üì± Send WhatsApp Message</button>
    <button id="newBooking" class="btn" disabled>üÜï New Booking</button>

    <h3 style="color:#b30000;margin-top:20px;">Retrieve Bill by Token</h3>
    <input id="searchToken" type="number" placeholder="Enter Token No" />
    <button id="searchBtn" class="btn">üîç Search Bill</button>
    <div id="searchResult" style="margin-top:10px;"></div>

    <div class="bookings">
      <h4 style="color:#b30000;margin-bottom:8px;">Saved Bookings</h4>
      <div id="bookingList"></div>
    </div>
  </div>

  <!-- Bill Popup -->
  <div class="popup" id="billPopup">
    <div class="popup-content" id="billContent">
      <h3>Dhriya Nasta House</h3>
      <div id="billDetails"></div>
      <button class="btn close-btn" onclick="closePopup()">Close</button>
    </div>
  </div>

<script>
let tokenCounter = 1001;
let paid = false;

// Load existing bookings
let bookings = JSON.parse(localStorage.getItem("bookings") || "[]");
if (bookings.length > 0) tokenCounter = bookings[bookings.length - 1].token + 1;
renderBookings();

// Auto update total
document.querySelectorAll('#items input').forEach(inp => inp.addEventListener('input', updateTotal));
function updateTotal() {
  let total = 0;
  document.querySelectorAll('#items input').forEach(i => total += i.value * i.dataset.price);
  document.getElementById('totalDisplay').innerText = `Total: ‚Çπ${total}`;
}

// Confirm payment
document.getElementById('confirmPay').addEventListener('click', () => {
  const name = document.getElementById('custName').value.trim();
  const phone = document.getElementById('custPhone').value.trim();
  if (name === '' || phone.length < 5) return alert("Please enter name and valid WhatsApp number!");
  paid = true;
  alert("‚úÖ Payment received successfully!");
  document.getElementById('generateToken').disabled = false;
});

// Generate token + bill
document.getElementById('generateToken').addEventListener('click', () => {
  if (!paid) return;
  const name = document.getElementById('custName').value.trim();
  const phone = document.getElementById('custPhone').value.trim();
  const items = document.querySelectorAll('#items input');
  let selected = [], total = 0;
  items.forEach(i => {
    const qty = parseInt(i.value);
    if (qty > 0) {
      const price = parseInt(i.dataset.price);
      const subtotal = qty * price;
      selected.push({name: i.dataset.name, weight: i.dataset.weight, price, qty, subtotal});
      total += subtotal;
    }
  });
  if (selected.length === 0) return alert("Please select at least one item!");

  const tokenNo = tokenCounter++;
  const order = {token: tokenNo, name, phone, selected, total, date: new Date().toLocaleString()};

  bookings.push(order);
  localStorage.setItem("bookings", JSON.stringify(bookings));
  renderBookings();

  displayBill(order);
  window.currentOrder = order;
  document.getElementById('waSend').disabled = false;
  document.getElementById('newBooking').disabled = false;
});

// Display bill popup
function displayBill(order) {
  let billHTML = `<p><b>Token No:</b> ${order.token}</p><p><b>Name:</b> ${order.name}</p><p><b>Contact:</b> ${order.phone}</p><hr>`;
  order.selected.forEach(it => {
    billHTML += `<div class="bill-item"><span>${it.name} (${it.weight}) x ${it.qty}</span><span>‚Çπ${it.subtotal}</span></div>`;
  });
  billHTML += `<hr><div class="bill-item"><b>Total:</b><b>‚Çπ${order.total}</b></div>`;
  document.getElementById('billDetails').innerHTML = billHTML;
  document.getElementById('billPopup').style.display = 'flex';
}

// Close popup
function closePopup() { document.getElementById('billPopup').style.display = 'none'; }

// WhatsApp message
document.getElementById('waSend').addEventListener('click', () => {
  const o = window.currentOrder;
  if (!o) return;
  const msgLines = [`‚úÖ Dear ${o.name},`, `Greetings from Dhriya Nasta House`, `Your Token Number: ${o.token}`, 'Booking Summary:'];
  o.selected.forEach(it => { msgLines.push(`# ${it.name} (${it.weight})`); msgLines.push(`   ‚Çπ${it.price} x ${it.qty} = ‚Çπ${it.subtotal}`); });
  msgLines.push(`Total Amount: ‚Çπ${o.total}`);
  const msg = encodeURIComponent(msgLines.join('\n'));
  const phone = o.phone.replace(/[^0-9]/g, '');
  window.open('https://wa.me/' + phone + '?text=' + msg, '_blank');
});

// New booking
document.getElementById('newBooking').addEventListener('click', () => {
  document.getElementById('custName').value = '';
  document.getElementById('custPhone').value = '+91 ';
  document.querySelectorAll('#items input').forEach(i => i.value = 0);
  document.getElementById('totalDisplay').innerText = 'Total: ‚Çπ0';
  document.getElementById('generateToken').disabled = true;
  document.getElementById('waSend').disabled = true;
  document.getElementById('newBooking').disabled = true;
  paid = false;
  alert('üÜï Ready for new booking!');
});

// Render saved bookings
function renderBookings() {
  const list = document.getElementById('bookingList');
  if (bookings.length === 0) {
    list.innerHTML = '<p style="color:#666;">No bookings yet.</p>';
    return;
  }

  list.innerHTML = bookings.map(b => `
    <div class="booking-entry" style="display:flex;justify-content:space-between;align-items:center;">
      <div style="flex:1;cursor:pointer;" onclick="showBookingDetails(${b.token})">
        <b>Token ${b.token}</b> ‚Äî ${b.name} ‚Äî ‚Çπ${b.total}
      </div>
      <div>
        <button onclick="editBooking(${b.token})" style="background:#ffa500;border:none;padding:4px 6px;border-radius:4px;color:white;cursor:pointer;">‚úèÔ∏è</button>
        <button onclick="deleteBooking(${b.token})" style="background:#d11a2a;border:none;padding:4px 6px;border-radius:4px;color:white;cursor:pointer;">üóëÔ∏è</button>
      </div>
    </div>
  `).join('');
}

// View saved booking
function showBookingDetails(token) {
  const booking = bookings.find(b => b.token === token);
  if (!booking) return;
  displayBill(booking);
}

// Delete booking
function deleteBooking(token) {
  if (!confirm("Are you sure you want to delete this booking?")) return;
  bookings = bookings.filter(b => b.token !== token);
  localStorage.setItem("bookings", JSON.stringify(bookings));
  renderBookings();
  alert("üóëÔ∏è Booking deleted successfully!");
}

// Edit booking (load back to form)
function editBooking(token) {
  const booking = bookings.find(b => b.token === token);
  if (!booking) return alert("Booking not found!");

  document.getElementById('custName').value = booking.name;
  document.getElementById('custPhone').value = booking.phone;

  document.querySelectorAll('#items input').forEach(i => {
    const found = booking.selected.find(it => it.name === i.dataset.name);
    i.value = found ? found.qty : 0;
  });

  updateTotal();
  document.getElementById('generateToken').disabled = false;
  document.getElementById('waSend').disabled = false;
  document.getElementById('newBooking').disabled = false;
  paid = true;

  alert("‚úèÔ∏è Booking details loaded ‚Äî you can modify and save again!");
}

// Search bill by token
document.getElementById('searchBtn').addEventListener('click', () => {
  const token = parseInt(document.getElementById('searchToken').value);
  const found = bookings.find(b => b.token === token);
  const resDiv = document.getElementById('searchResult');
  if (found) {
    displayBill(found);
    resDiv.innerHTML = '';
  } else {
    resDiv.innerHTML = '<p style="color:red;">‚ùå No bill found for this token!</p>';
  }
});
</script>
</body>
</html>
